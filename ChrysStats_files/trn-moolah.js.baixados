const script = document.currentScript;

window.trackerads= {
    version: '1.0.1',
    primisId: script.dataset.primisId,
    primisMobileId: script.dataset.primisMobileId,
    disableCPMStartEvents: script.dataset.cpmstartEvents,
    mode: script.dataset.mode,
    cpmstarLoaded: false,
    primisLoaded: false,
    initializeExternalAdNetworks: function () {        
        var pathName = window.location.pathname

        if (pathName === '/') {
            return
        }

        initializeCpmStar('752_52468_hb');
    }
};
function initializePrimis(primis) {    
    var pathName = window.location.pathname

    if (!window.trackerads.primisId) {
        return
    }
    if (!window.trnads.primisLoaded) {
        window.trackerads.primisLoaded = true;

        var primisId = window.trackerads.primisId; 
        
        if (window.trackerads.primisMobileId && window.matchMedia("only screen and (max-width: 760px)").matches) {
            primisId = window.trackerads.primisMobileId;
            console.log("This is a mobile device1.");
            
            const script = document.createElement('script')
            script.src = 'https://live.primis.tech/live/liveView.php?s=' + primisId
            script.type = 'text/javascript'    
            document.body.prepend(script)

         } else {
            const script = document.createElement('script')
            script.src = 'https://live.primis.tech/live/liveView.php?s=' + primisId
            script.type = 'text/javascript'    
    
            document.body.appendChild(script)
         }
    }
    
}

function initializeCpmStar(zonefile) {
    
    if (window.trackerads.cpmstarLoaded) {
        return;
    }
    window.trackerads.cpmstarLoaded = true;

    console.log('loading CPM STAR')

    var y="cpmstarx";
    var drutObj = window[y] = window[y] || {};
    function failCpmstarAPI() { var failFn = function(o) { o && typeof(o) === "object" && o.fail && o.fail(); }; drutObj && Array.isArray(drutObj.cmd) && drutObj.cmd.forEach(failFn) && (drutObj.cmd.length = 0);  window.cpmstarAPI = window["_"+zonefile] = failFn; }
    var rnd = Math.round(Math.random()*999999);
    var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.onerror=failCpmstarAPI;
    var proto = document.location.protocol;
    var host = ( proto == "https:" || proto == "file:")?"https://server":"//cdn";
    if(window.location.hash=="#cpmstarDev") host = "//dev.server";
    if(window.location.hash=="#cpmstarStaging") host = "//staging.server"; 
    s.src = host + ".cpmstar.com/cached/zonefiles/" + zonefile + ".js?rnd="+rnd; 
    var s2=document.getElementsByTagName('script')[0];
    s2.parentNode.insertBefore(s, s2);
    window.cpmstarAPI = function(o) { (drutObj.cmd = drutObj.cmd || []).push(o); }
}


window.cpmstarnoskin = function () {
    console.log('cpmstar no skin');
    initializePrimis();
}

if (window.trackerads.mode !== 'spa') {
    window.trackerads.initializeExternalAdNetworks();
}
